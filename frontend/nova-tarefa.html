<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Nova Tarefa - TechSolutions</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <h2>üè¢ TechSolutions - Nova Tarefa</h2>
        <div>
            <span id="userName"></span>
            <button onclick="logout()" class="btn-logout">Sair</button>
        </div>
    </nav>

    <div class="container">
        <div class="menu">
            <a href="/dashboard" class="btn">Dashboard</a>
            <a href="/tarefas" class="btn">Tarefas</a>
            <a href="/nova-tarefa" class="btn btn-success">+ Nova Tarefa</a>
        </div>

        <h2>‚ûï Nova Tarefa</h2>
        
        <form id="taskForm" onsubmit="saveTask(event)">
            <div class="form-group">
                <label>T√≠tulo *</label>
                <input type="text" id="title" required>
            </div>
            
            <div class="form-group">
                <label>Descri√ß√£o</label>
                <textarea id="description" rows="3"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Categoria *</label>
                    <select id="category" required>
                        <option value="">Selecione...</option>
                        <option value="venda">Venda de Equipamentos</option>
                        <option value="reparo_pc">Repara√ß√£o de PC</option>
                        <option value="reparo_celular">Repara√ß√£o de Celular</option>
                        <option value="reparo_impressora">Repara√ß√£o de Impressora</option>
                        <option value="instalacao_software">Instala√ß√£o de Software</option>
                        <option value="rede">Configura√ß√£o de Rede</option>
                        <option value="backup">Backup de Dados</option>
                        <option value="outros">Outros Servi√ßos</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Prioridade</label>
                    <select id="priority">
                        <option value="low">Baixa</option>
                        <option value="medium" selected>M√©dia</option>
                        <option value="high">Alta</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nome do Cliente *</label>
                <input type="text" id="client_name" required>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="client_phone">
                </div>
                
                <div class="form-group">
                    <label>Prazo</label>
                    <input type="date" id="due_date">
                </div>
            </div>
            
            <div class="form-group">
                <label>Or√ßamento (R$)</label>
                <input type="number" id="budget" step="0.01">
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-success">Salvar Tarefa</button>
                <a href="/tarefas" class="btn">Cancelar</a>
            </div>
        </form>
    </div>

    <script>
        // Verificar login
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            window.location.href = '/login';
        } else {
            document.getElementById('userName').textContent = user.name;
        }

        async function saveTask(event) {
            event.preventDefault();
            
            const task = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                category: document.getElementById('category').value,
                priority: document.getElementById('priority').value,
                client_name: document.getElementById('client_name').value,
                client_phone: document.getElementById('client_phone').value,
                due_date: document.getElementById('due_date').value,
                budget: document.getElementById('budget').value || 0
            };
            
            try {
                const response = await fetch('/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(task)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Tarefa criada com sucesso!');
                    window.location.href = '/tarefas';
                } else {
                    alert('Erro ao criar tarefa: ' + (data.error || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('Erro de conex√£o com o servidor');
            }
        }

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => {
                    localStorage.removeItem('user');
                    window.location.href = '/login';
                });
        }
    </script>
</body>
</html>