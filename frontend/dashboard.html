<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - TechSolutions</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <h2>ğŸ¢ TechSolutions</h2>
        <div>
            <span id="userName"></span>
            <button type="button" onclick="logout()" class="btn-logout">Sair</button>
        </div>
    </nav>

    <div class="container">
        <div class="menu">
            <a href="/dashboard" class="btn">Dashboard</a>
            <a href="/tarefas" class="btn">Tarefas</a>
            <a href="/nova-tarefa" class="btn btn-success">+ Nova Tarefa</a>
        </div>

        <h2>ğŸ“Š EstatÃ­sticas</h2>
        <div class="stats" id="stats">
            <div class="stat-card">
                <div>ğŸ“‹</div>
                <h3>Total</h3>
                <div class="stat-number" id="total">0</div>
            </div>
            <div class="stat-card">
                <div>â³</div>
                <h3>Pendentes</h3>
                <div class="stat-number" id="pending">0</div>
            </div>
            <div class="stat-card">
                <div>ğŸ”„</div>
                <h3>Em Andamento</h3>
                <div class="stat-number" id="inProgress">0</div>
            </div>
            <div class="stat-card">
                <div>âœ…</div>
                <h3>ConcluÃ­das</h3>
                <div class="stat-number" id="completed">0</div>
            </div>
        </div>

        <h2>ğŸ“‹ Tarefas Recentes</h2>
        <div id="recentTasks">
            Carregando...
        </div>
    </div>

    <script>
        // Verificar se estÃ¡ logado
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            window.location.href = '/login';
        } else {
            document.getElementById('userName').textContent = user.name;
        }

        async function loadDashboard() {
            try {
                // Carregar estatÃ­sticas
                const statsResponse = await fetch('/api/dashboard/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    document.getElementById('total').textContent = statsData.stats.total;
                    document.getElementById('pending').textContent = statsData.stats.pending;
                    document.getElementById('inProgress').textContent = statsData.stats.in_progress;
                    document.getElementById('completed').textContent = statsData.stats.completed;
                }

                // Carregar tarefas recentes
                const tasksResponse = await fetch('/api/tasks?limit=5');
                const tasksData = await tasksResponse.json();
                
                if (tasksData.success && tasksData.tasks.length > 0) {
                    const html = tasksData.tasks.slice(0, 5).map(task => `
                        <div class="task-item">
                            <strong>${task.title}</strong>
                            <span>${task.client_name}</span>
                            <span class="status ${task.status}">
                                ${task.status === 'completed' ? 'âœ… ConcluÃ­da' : 
                                  task.status === 'in_progress' ? 'ğŸ”„ Em andamento' : 'â³ Pendente'}
                            </span>
                            <a href="/tarefa/${task.id}">Ver detalhes</a>
                        </div>
                    `).join('');
                    document.getElementById('recentTasks').innerHTML = html;
                } else {
                    document.getElementById('recentTasks').innerHTML = '<p>Nenhuma tarefa encontrada.</p>';
                }
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('recentTasks').innerHTML = '<p>Erro ao carregar tarefas.</p>';
            }
        }

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => {
                    localStorage.removeItem('user');
                    window.location.href = '/login';
                });
        }

        // Carregar dashboard ao iniciar
        loadDashboard();
    </script>
</body>
</html>